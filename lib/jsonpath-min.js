var module;!function(glbl,require){"use strict";function push(t,e){return t=t.slice(),t.push(e),t}function unshift(t,e){return e=e.slice(),e.unshift(t),e}function NewError(t){this.avoidNew=!0,this.value=t,this.message='JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'}function JSONPath(t,e,r,a,n){if(!(this instanceof JSONPath))try{return new JSONPath(t,e,r,a,n)}catch(s){if(!s.avoidNew)throw s;return s.value}"string"==typeof t&&(n=a,a=r,r=e,e=t,t={}),t=t||{};var i=t.hasOwnProperty("json")&&t.hasOwnProperty("path");if(this.json=t.json||r,this.path=t.path||e,this.resultType=t.resultType&&t.resultType.toLowerCase()||"value",this.flatten=t.flatten||!1,this.wrap=t.hasOwnProperty("wrap")?t.wrap:!0,this.sandbox=t.sandbox||{},this.preventEval=t.preventEval||!1,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||a||null,this.otherTypeCallback=t.otherTypeCallback||n||function(){throw new Error("You must supply an otherTypeCallback callback option with the @other() operator.")},t.autostart!==!1){var o=this.evaluate({path:i?t.path:e,json:i?t.json:r});if(!o||"object"!=typeof o)throw new NewError(o);return o}}var isNode=module&&!!module.exports,allowedResultTypes=["value","path","pointer","parent","parentProperty","all"];Array.prototype.includes||(Array.prototype.includes=function(t){return this.indexOf(t)>-1}),String.prototype.includes||(String.prototype.includes=function(t){return this.indexOf(t)>-1});var moveToAnotherArray=function(t,e,r){for(var a=0,n=t.length;n>a;a++){var s=t[a];r(s)&&e.push(t.splice(a--,1)[0])}},vm=isNode?require("vm"):{runInNewContext:function(expr,context){var keys=Object.keys(context),funcs=[];moveToAnotherArray(keys,funcs,function(t){return"function"==typeof context[t]});var code=funcs.reduce(function(t,e){return"var "+e+"="+context[e].toString()+";"+t},"");return code+=keys.reduce(function(t,e){return"var "+e+"="+JSON.stringify(context[e]).replace(/\u2028|\u2029/g,function(t){return"\\u202"+("\u2028"===t?"8":"9")})+";"+t},expr),eval(code)}};JSONPath.prototype.evaluate=function(t,e,r,a){var n=this,s=this.flatten,i=this.wrap,o=this.parent,h=this.parentProperty;if(this.currResultType=this.resultType,this.currPreventEval=this.preventEval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=a||this.otherTypeCallback,e=e||this.json,t=t||this.path,t&&"object"==typeof t){if(!t.path)throw new Error('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');e=t.hasOwnProperty("json")?t.json:e,s=t.hasOwnProperty("flatten")?t.flatten:s,this.currResultType=t.hasOwnProperty("resultType")?t.resultType:this.currResultType,this.currSandbox=t.hasOwnProperty("sandbox")?t.sandbox:this.currSandbox,i=t.hasOwnProperty("wrap")?t.wrap:i,this.currPreventEval=t.hasOwnProperty("preventEval")?t.preventEval:this.currPreventEval,r=t.hasOwnProperty("callback")?t.callback:r,this.currOtherTypeCallback=t.hasOwnProperty("otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,o=t.hasOwnProperty("parent")?t.parent:o,h=t.hasOwnProperty("parentProperty")?t.parentProperty:h,t=t.path}if(o=o||null,h=h||null,Array.isArray(t)&&(t=JSONPath.toPathString(t)),t&&e&&allowedResultTypes.includes(this.currResultType)){this._obj=e;var p=JSONPath.toPathArray(t);"$"===p[0]&&p.length>1&&p.shift(),this._hasParentSelector=null;var l=this._trace(p,e,["$"],o,h,r);return l=l.filter(function(t){return t&&!t.isParentSelector}),l.length?1!==l.length||i||Array.isArray(l[0].value)?l.reduce(function(t,e){var r=n._getPreferredOutput(e);return s&&Array.isArray(r)?t=t.concat(r):t.push(r),t},[]):this._getPreferredOutput(l[0]):i?[]:void 0}},JSONPath.prototype._getPreferredOutput=function(t){var e=this.currResultType;switch(e){case"all":return t.path="string"==typeof t.path?t.path:JSONPath.toPathString(t.path),t;case"value":case"parent":case"parentProperty":return t[e];case"path":return JSONPath.toPathString(t[e]);case"pointer":return JSONPath.toPointer(t.path)}},JSONPath.prototype._handleCallback=function(t,e,r){if(e){var a=this._getPreferredOutput(t);t.path="string"==typeof t.path?t.path:JSONPath.toPathString(t.path),e(a,r,t)}},JSONPath.prototype._trace=function(t,e,r,a,n,s,i){function o(t){f.push(t)}function h(t){Array.isArray(t)?t.forEach(o):f.push(t)}var p,l=this;if(!t.length)return p={path:r,value:e,parent:a,parentProperty:n},this._handleCallback(p,s,"value"),p;var c=t[0],u=t.slice(1),f=[];if(("string"!=typeof c||i)&&e&&Object.prototype.hasOwnProperty.call(e,c))h(this._trace(u,e[c],push(r,c),e,c,s));else if("*"===c)this._walk(c,u,e,r,a,n,s,function(t,e,r,a,n,s,i,o){h(l._trace(unshift(t,r),a,n,s,i,o,!0))});else if(".."===c)h(this._trace(u,e,r,a,n,s)),this._walk(c,u,e,r,a,n,s,function(t,e,r,a,n,s,i,o){"object"==typeof a[t]&&h(l._trace(unshift(e,r),a[t],push(n,t),a,t,o))});else{if("^"===c)return this._hasParentSelector=!0,r.length?{path:r.slice(0,-1),expr:u,isParentSelector:!0}:[];if("~"===c)return p={path:push(r,c),value:n,parent:a,parentProperty:null},this._handleCallback(p,s,"property"),p;if("$"===c)h(this._trace(u,e,r,null,null,s));else if(/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(c))h(this._slice(c,u,e,r,a,n,s));else if(0===c.indexOf("?(")){if(this.currPreventEval)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");this._walk(c,u,e,r,a,n,s,function(t,e,r,a,n,s,i,o){l._eval(e.replace(/^\?\((.*?)\)$/,"$1"),a[t],t,n,s,i)&&h(l._trace(unshift(t,r),a,n,s,i,o))})}else if("("===c[0]){if(this.currPreventEval)throw new Error("Eval [(expr)] prevented in JSONPath expression.");h(this._trace(unshift(this._eval(c,e,r[r.length-1],r.slice(0,-1),a,n),u),e,r,a,n,s))}else if("@"===c[0]){var y=!1,v=c.slice(1,-2);switch(v){case"scalar":e&&["object","function"].includes(typeof e)||(y=!0);break;case"boolean":case"string":case"undefined":case"function":typeof e===v&&(y=!0);break;case"number":typeof e===v&&isFinite(e)&&(y=!0);break;case"nonFinite":"number"!=typeof e||isFinite(e)||(y=!0);break;case"object":e&&typeof e===v&&(y=!0);break;case"array":Array.isArray(e)&&(y=!0);break;case"other":y=this.currOtherTypeCallback(e,r,a,n);break;case"integer":e!==+e||!isFinite(e)||e%1||(y=!0);break;case"null":null===e&&(y=!0)}if(y)return p={path:r,value:e,parent:a,parentProperty:n},this._handleCallback(p,s,"value"),p}else if("`"===c[0]&&e&&Object.prototype.hasOwnProperty.call(e,c.slice(1))){var P=c.slice(1);h(this._trace(u,e[P],push(r,P),e,P,s,!0))}else if(c.includes(",")){var d,O;for(d=c.split(","),O=0;O<d.length;O++)h(this._trace(unshift(d[O],u),e,r,a,n,s))}else!i&&e&&Object.prototype.hasOwnProperty.call(e,c)&&h(this._trace(u,e[c],push(r,c),e,c,s,!0))}if(this._hasParentSelector)for(var b=0;b<f.length;b++){var g=f[b];if(g.isParentSelector){var S=l._trace(g.expr,e,g.path,a,n,s);if(Array.isArray(S)){f[b]=S[0];for(var w=1,_=S.length;_>w;w++)b++,f.splice(b,0,S[w])}else f[b]=S}}return f},JSONPath.prototype._walk=function(t,e,r,a,n,s,i,o){var h,p,l;if(Array.isArray(r))for(h=0,p=r.length;p>h;h++)o(h,t,e,r,a,n,s,i);else if("object"==typeof r)for(l in r)Object.prototype.hasOwnProperty.call(r,l)&&o(l,t,e,r,a,n,s,i)},JSONPath.prototype._slice=function(t,e,r,a,n,s,i){if(Array.isArray(r)){var o,h=r.length,p=t.split(":"),l=p[0]&&parseInt(p[0],10)||0,c=p[1]&&parseInt(p[1],10)||h,u=p[2]&&parseInt(p[2],10)||1;l=0>l?Math.max(0,l+h):Math.min(h,l),c=0>c?Math.max(0,c+h):Math.min(h,c);var f=[];for(o=l;c>o;o+=u){var y=this._trace(unshift(o,e),r,a,n,s,i);Array.isArray(y)?y.forEach(function(t){f.push(t)}):f.push(y)}return f}},JSONPath.prototype._eval=function(t,e,r,a,n,s){if(!this._obj||!e)return!1;t.includes("@parentProperty")&&(this.currSandbox._$_parentProperty=s,t=t.replace(/@parentProperty/g,"_$_parentProperty")),t.includes("@parent")&&(this.currSandbox._$_parent=n,t=t.replace(/@parent/g,"_$_parent")),t.includes("@property")&&(this.currSandbox._$_property=r,t=t.replace(/@property/g,"_$_property")),t.includes("@path")&&(this.currSandbox._$_path=JSONPath.toPathString(a.concat([r])),t=t.replace(/@path/g,"_$_path")),t.match(/@([\.\s\)\[])/)&&(this.currSandbox._$_v=e,t=t.replace(/@([\.\s\)\[])/g,"_$_v$1"));try{return vm.runInNewContext(t,this.currSandbox)}catch(i){throw console.log(i),new Error("jsonPath: "+i.message+": "+t)}},JSONPath.cache={},JSONPath.toPathString=function(t){var e,r,a=t,n="$";for(e=1,r=a.length;r>e;e++)/^(~|\^|@.*?\(\))$/.test(a[e])||(n+=/^[0-9*]+$/.test(a[e])?"["+a[e]+"]":"['"+a[e]+"']");return n},JSONPath.toPointer=function(t){var e,r,a=t,n="";for(e=1,r=a.length;r>e;e++)/^(~|\^|@.*?\(\))$/.test(a[e])||(n+="/"+a[e].toString().replace(/\~/g,"~0").replace(/\//g,"~1"));return n},JSONPath.toPathArray=function(t){var e=JSONPath.cache;if(e[t])return e[t].concat();var r=[],a=t.replace(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/g,";$&;").replace(/[\['](\??\(.*?\))[\]']/g,function(t,e){return"[#"+(r.push(e)-1)+"]"}).replace(/\['([^'\]]*)'\]/g,function(t,e){return"['"+e.replace(/\./g,"%@%").replace(/~/g,"%%@@%%")+"']"}).replace(/~/g,";~;").replace(/'?\.'?(?![^\[]*\])|\['?/g,";").replace(/%@%/g,".").replace(/%%@@%%/g,"~").replace(/(?:;)?(\^+)(?:;)?/g,function(t,e){return";"+e.split("").join(";")+";"}).replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),n=a.split(";").map(function(t){var e=t.match(/#([0-9]+)/);return e&&e[1]?r[e[1]]:t});return e[t]=n,e[t]},JSONPath.eval=function(t,e,r){return JSONPath(r,e,t)},"function"==typeof define&&define.amd?define(function(){return JSONPath}):isNode?module.exports=JSONPath:(glbl.jsonPath={eval:JSONPath.eval},glbl.JSONPath=JSONPath)}(this||self,"undefined"==typeof require?null:require);